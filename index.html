<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8" />
		<title>super chat</title>
		<style>
			#zone_chat { max-height: 1000px; overflow-y: hidden; word-break: break-all; }
			#zone_chat strong { color: white; background-color: slateblue; padding: 2px; }
		</style>
	</head>
 
	<body>
		<h1>Le super Chat temps reel !</h1>

		<form action="/" method="post" id="formulaire_chat">
			<input type="text" name="message" id="message" placeholder="Votre message..." size="50" autofocus />
			<input type="submit" id="envoi_message" value="envoyer" />
		</form>

		<section id="zone_chat">
			
		</section>


		<script src="http://code.jquery.com/jquery-1.10.1.min.js"></script>
		<script src="/socket.io/socket.io.js"></script>
		<script>

			var socket = io.connect('http://localhost:8080');

			pseudo = prompt('Quel est votre pseudo ?');
			socket.emit('nouveau_client', pseudo);
			document.title = pseudo + ' - ' + document.title;

			// quand on recoit un message
			socket.on('message', function(data) {
				insereMessage(data.pseudo, data.message)
			})

			// quand un nouveau client se connecte
			socket.on('nouveau_client', function(pseudo) {
				$('#zone_chat').prepend('<p><em><strong>' + pseudo + '</strong> a rejoint le Chat !</em></p>');
			})

			// quand on envoie un message, transmet au serveur puis on l'affiche
			$('#formulaire_chat').submit(function() {
				var message = $('#message').val();
				socket.emit('message', message);
				insereMessage(pseudo, message);

				$('#message').val('').focus(); // vide la zone de chat

				return false; // permet de bloquer l'envoi "classique"
			});

			function insereMessage(pseudo, message) {
				$('#zone_chat').prepend('<p><strong>' + pseudo + '</strong> ' + message + '</p>');
			}

		</script>
	</body>
</html>